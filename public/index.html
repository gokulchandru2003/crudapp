<!DOCTYPE html>
<html ng-app="myApp">

<head>
  <title>Students Portal</title>
  <link rel="stylesheet" type="text/css" href="index.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>

</head>

<body ng-app="myApp">

<div ng-controller="RegistrationController">
  <form  id="full-form" name="registrationForm" >

    <div id="searchUser" align="right">
      <a href="#" ng-click="searchUser()">{{title}}</a>
    </div>

    <div class="container">
      <div class="form-head" ng-hide="ifSearchUser">
        <h3>Student Portal</h3>
        <h1>Registration Form</h1>

        <div class="form" id="form" >
          <div class="form-inputs">
          Name:
          <input type="text" id="name" name="name"  ng-model="newstudent.name" placeholder="Enter your name" required>

          Age:
          <input type="number" id="age" name="age" ng-model="newstudent.age" placeholder="Enter your age" required>

          <div class="form-gender">
            Gender:
            <select id="gender" name="gender" ng-model="newstudent.gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
            <!-- <input type="radio" id="male" name="newstudent.gender" ng-model="gender" value="Male" required="">Male
            <input type="radio" id="female" name="gender" ng-model="newstudent.gender" value="Female" required="">Female -->
          </div>

          Date of Birth:
          <input type="date" id="dob" name="dob" ng-model="newstudent.dob" required>

          Number:
          <input type="number" id="number" name="number" ng-model="newstudent.number" placeholder="Enter your mobile number" required>

          Gmail:
          <input type="email" id="gmail" name="gmail" ng-model="newstudent.gmail" placeholder="Enter your email" required>
        </div>

        <input type="hidden" ng-model="newstudent.id">
        <button type="button" ng-click="saveStudent()">SUBMIT</button>
        </div>
      </div>
    </div>

    <h4>Registered Students</h4>
    <table ng-if="students.length" border="4" id="show">
      <thead>
      <tr class="info">
        <th>NAME</th>
        <th>AGE</th>
        <th>GENDER</th>
        <th>DOB</th>
        <th>NUMBER</th>
        <th>GMAIL ID</th>
        <th ng-if="!ifSearchUser">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="student in students">
        <td>{{ student.name }}</td>
        <td>{{ student.age }}</td>
        <td>{{student.gender}}</td>
        <td>{{ student.dob | date:'dd/MM/yyyy' }}</td>
        <td>{{ student.number }}</td>
        <td>{{ student.gmail }}</td>
        <td ng-if="!ifSearchUser">
            <a href="#" ng-click="edit(student.id)" role = "button" class = "edit-btn">edit</a> &nbsp;
            <a href="#" ng-click="delete(student.id)" role = "button" class = "delete-btn">delete</a>
          </td>
      </tr>
    </tbody>
    </table>
    <div ng-hide="students.length > 0">No Students Found</div>
  </form>
</div>

<script>
    var myApp = angular.module('myApp', []);

    myApp.service("StudentService", function () {
      var uid = 1;
      var students =[{
        'id': 0,
        'name': 'Ruthuraj',
        'age': 20,
        'dob': '2002-01-01',
        'gender': 'Male',
        'phone': 1234567890,
        'email': 'ruthu.raj@gmail.com'
      }];

      this.save = function (student) {
        if (student.id == null) {
          student.id = uid++;
          students.push(student);
        } else {
          for (var i in students) {
            if ( students[i].id == student.id){
              students[i] = student;
            }
          }
        }
      };

      this.get = function (id) {
    for (var i in students) {
      if (students[i].id == id) {
        return students[i];
      }
    }
  };

  this.delete = function (id) {
    for (var i in students) {
      if (students[i].id == id) {
        students.splice(i, 1);
      }
    }
  };

  this.list = function () {
    return students;
  };

    });

myApp.controller('RegistrationController', function ($scope,$http, StudentService) {

   $scope.ifSearchUser = false;
    $scope.title ="List of Users";

  $scope.students = StudentService.list();

  $scope.saveStudent = function () {
    console.log($scope.newstudent)
    if ($scope.newstudent == null || $scope.newstudent == angular.undefined) 
      return;


 $http.post('/api/students', $scope.newstudent)
      .then(function (response) {
        // Data successfully sent to the server
        $scope.newstudent = {};
        // Update the students array after saving a new student
        $scope.students = StudentService.list();
      })
      .catch(function (error) {
        // Handle error
        console.error('Error saving student:', error);
      });
  



    StudentService.save($scope.newstudent);
    $scope.newstudent = {};

     $scope.students = StudentService.list();

  };

  $scope.edit = function (id) {
        $scope.newstudent = angular.copy(StudentService.get(id));

    };

    $scope.delete = function (id) {
        StudentService.delete(id);
        if ($scope.newstudent != angular.undefined && $scope.newstudent.id == id) {
            $scope.newstudent = {};
        }

    };

    $scope.searchUser = function(){
      if($scope.title == "List of Users"){
        $scope.ifSearchUser=true;
        $scope.title = "Back";
      }
      else
      {
        $scope.ifSearchUser = false;
        $scope.title = "List of Users";
      }     
    };

  });
  
      // ... Your validation code ...
      // var nameRegex = /^[a-zA-Z\s]+$/; 
      // var ageRegex = /^\d{2}$/; 
      // var numberRegex = /^\d{10}$/;
      // var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

         //  if( $scope.name.length<5 || !nameRegex.test($scope.name) ){
         //    alert("Name have minimum 5 letters and alphabet only!!");

         //  }else if( !ageRegex.test($scope.age) ){
         //    alert("Enter valid Age");

         //  }else if( !numberRegex.test($scope.number) ){
         //    alert("Please enter 10 digit NUMBER");

         //  }else if( !emailRegex.test($scope.gmail) ){
         //    alert("Please enter valid EMAIL ID!!");

         //  }


  </script>

</body>

</html>